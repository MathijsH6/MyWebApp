<script>
  window.isLoggedIn = "<%= typeof customer_id !== 'undefined' && customer_id ? 'true' : 'false' %>";
</script>

<header style="display: flex; align-items: center; padding-left: 2rem; position: relative;">
  <img id="logo-img" src="/images/Logo.png" alt="Logo" style="height:48px; width:auto; margin-right:1rem; vertical-align:middle; cursor:pointer;">
  <nav class="nav-btns" style="flex: 1;">
    <a href="/" class="btn btn-outline-primary">Home</a>
    <a href="/films" class="btn btn-outline-primary">Films</a>
    <a href="/locations" class="btn btn-outline-primary">Locaties</a>
    <a href="/about" class="btn btn-outline-primary">About</a>
    <a href="/contact" class="btn btn-outline-primary">Contact</a>
  </nav>
  <div class="dropdown" style="position: absolute; top: 1rem; right: 2rem;">
    <button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person-circle me-2" viewBox="0 0 16 16">
        <path d="M13.468 12.37C12.758 11.226 11.482 10.5 10 10.5c-1.482 0-2.758.726-3.468 1.87A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"/>
        <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/>
      </svg>
      Profiel
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
      <% if (typeof customer_id !== 'undefined' && customer_id) { %>
        <li>
          <a class="dropdown-item" href="/register">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-lines-fill me-2" viewBox="0 0 16 16">
              <path d="M1 14s1 0 1-1-1-4-6-4-6 4-6 4 1 1 1 1h10zm7-7a3 3 0 1 0-6 0 3 3 0 0 0 6 0zm4.5 1a.5.5 0 0 1 .5.5v.5h-3v-.5a.5.5 0 0 1 .5-.5h2zm.5 2.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-.5h3v.5zm-3 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v.5h-3v-.5z"/>
            </svg>
            Profiel
          </a>
        </li>
        <li>
          <form id="logoutForm" action="/login/logout" method="POST" style="margin:0;">
            <button class="dropdown-item logout-btn d-flex align-items-center" type="submit">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-right me-2" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M6 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V3zm1-1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H7z"/>
                <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H9.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
              </svg>
              Uitloggen
            </button>
          </form>
        </li>
      <% } else { %>
        <li><a class="dropdown-item" href="/register">Registreren</a></li>
        <li><a class="dropdown-item" href="/login">Inloggen</a></li>
      <% } %>
      <li><button class="dropdown-item" id="showFavoritesBtn" type="button">Favorieten</button></li>
    </ul>
  </div>
</header>

<!-- Logo modal animation -->
<div id="logo-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:9999; background:rgba(0,0,0,0.3); backdrop-filter: blur(8px); justify-content:center; align-items:center;">
  <img src="/images/Logo.png" alt="Logo" style="height:300px; width:auto; box-shadow:0 4px 32px rgba(0,0,0,0.2); background:#0a0a0a; border-radius:24px; padding:2rem; transition:transform 0.3s;">
</div>

<!-- Favorites modal -->
<div id="favorites-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:9999; background:rgba(0,0,0,0.3); backdrop-filter: blur(8px); justify-content:center; align-items:center;">
  <div style="background:#fff; border-radius:24px; padding:2rem; min-width:400px; max-width:80vw; max-height:70vh; overflow:hidden; box-shadow:0 4px 32px rgba(0,0,0,0.2); display:flex; flex-direction:column; align-items:center;">
    <h3 class="mb-3">Favorieten</h3>
    <div id="favorites-scroll" style="display:flex; gap:1rem; overflow-x:auto; width:100%; padding-bottom:1rem;">
      <!-- Favorite films will be rendered here -->
    </div>
    <button class="btn btn-secondary mt-2" id="closeFavoritesBtn">Sluiten</button>
  </div>
</div>

<script>
  const logoImg = document.getElementById('logo-img');
  const logoModal = document.getElementById('logo-modal');
  const favoritesBtn = document.getElementById('showFavoritesBtn');
  const favoritesModal = document.getElementById('favorites-modal');
  const closeFavoritesBtn = document.getElementById('closeFavoritesBtn');
  const favoritesScroll = document.getElementById('favorites-scroll');

  if (logoImg && logoModal) {
    logoImg.addEventListener('click', () => {
      logoModal.style.display = 'flex';
    });

    logoModal.addEventListener('click', () => {
      logoModal.style.display = 'none';
    });
  }

  function renderFavoritesModal() {
    favoritesScroll.innerHTML = '';
    if (window.isLoggedIn !== "true") {
      favoritesScroll.innerHTML = '<span class="text-danger">Je bent niet ingelogd. Maak een account aan en log in.</span>';
      return;
    }
    if (window.favoriteIds && window.filmsData) {
      let hasFavorites = false;
      window.favoriteIds.forEach(favId => {
        const film = window.filmsData.find(f => f.film_id === favId);
        if (film) {
          hasFavorites = true;
          favoritesScroll.innerHTML += `
            <a href="/films/${film.film_id}" style="text-decoration:none; color:inherit;">
              <div style="min-width:200px; max-width:220px; background:#f8f9fa; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.07); padding:1rem; display:flex; flex-direction:column; align-items:center;">
                <strong>${film.title}</strong>
                <span class="text-muted">${film.release_year}</span>
                <span>${film.genre}</span>
                <span>${film.rating}</span>
              </div>
            </a>
          `;
        }
      });
      if (!hasFavorites) {
        favoritesScroll.innerHTML = '<span class="text-muted">Nog geen favorieten geselecteerd.</span>';
      }
    }
  }

  if (favoritesBtn && favoritesModal) {
    favoritesBtn.addEventListener('click', () => {
      renderFavoritesModal();
      favoritesModal.style.display = 'flex';
    });

    closeFavoritesBtn.addEventListener('click', () => {
      favoritesModal.style.display = 'none';
    });

    favoritesModal.addEventListener('click', (e) => {
      if (e.target === favoritesModal) {
        favoritesModal.style.display = 'none';
      }
    });
  }
</script>